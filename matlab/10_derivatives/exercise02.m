clc
clear all
close all

format long e

x_1 = [0 0.500000000000000 1 1.50000000000000 2 2.50000000000000 3 3.50000000000000 4];
y_1 = [1 1.01972784447234 0.425324148260754 0.00750249000360903 0.255653805962070 0.882134329567183 1.10129029471023 0.403119026653685 -0.902302529116542];

x_2 = [0 0.200000000000000 0.400000000000000 0.600000000000000 0.800000000000000 1 1.20000000000000 1.40000000000000 1.60000000000000 1.80000000000000 2 2.20000000000000 2.40000000000000 2.60000000000000 2.80000000000000 3 3.20000000000000 3.40000000000000 3.60000000000000 3.80000000000000 4];
y_2 = [1 1.11973032479795 1.08612505165582 0.927000227871709 0.688156568598234 0.425324148260754 0.194645370425981 0.0432273893198020 0.00127882724675199 0.0770892145440482 0.255653805962070 0.501163533841171 0.762962163990597 0.984018043121841 1.11055402866615 1.10129029471023 0.934810775330613 0.613856388322994 0.165830871237402 -0.360598048360463 -0.902302529116542];

% f = @(x) sin(x)+cos(2*x);
f_0 = @(x) cos(x)-2*sin(2*x);

%% First method
subplot(2,2,1)
sum_1 = 0;

f_C = @(i) (y_1(i+1)-y_1(i-1))/(2*0.5);
f_R = @(i) (-3*y_1(i)+4*y_1(i+1)-y_1(i+2))/(2*0.5); 
f_L = @(i) (y_1(i-2)-4*y_1(i-1)+3*y_1(i))/(2*0.5);

plot(x_1(1,:), f_0(x_1(1,:)), 'b-')
hold on
title('First set')

for i=2:length(x_1)-1
    plot(x_1(1,i), f_C(i), 'g*')
    sum_1 = sum_1 + ((f_0(x_1(1,i)) - f_C(i)).^2);
end

plot(x_1(1,1), f_R(1), 'r*')
sum_1 = sum_1 + ((f_0(x_1(1,1)) - f_R(1)).^2);

plot(x_1(1,end), f_L(length(x_1)), 'r*')
sum_1 = sum_1 + ((f_0(x_1(1,end)) - f_L(length(x_1))).^2);

subplot(2,2,2)
sum_2 = 0;

f_C = @(i) (y_2(i+1)-y_2(i-1))/(2*0.2);
f_R = @(i) (-3*y_2(i)+4*y_2(i+1)-y_2(i+2))/(2*0.2); 
f_L = @(i) (y_2(i-2)-4*y_2(i-1)+3*y_2(i))/(2*0.2);

plot(x_2(1,:), f_0(x_2(1,:)), 'b-')
hold on
title('Second set')

for i=2:length(x_2)-1
    plot(x_2(1,i), f_C(i), 'g*')
    sum_2 = sum_2 + ((f_0(x_2(1,i)) - f_C(i)).^2);
end

plot(x_2(1,1), f_R(1), 'r*')
sum_2 = sum_2 + ((f_0(x_2(1,1)) - f_R(1)).^2);

plot(x_2(1,end), f_L(length(x_2)), 'r*')
sum_2 = sum_2 + ((f_0(x_2(1,end)) - f_L(length(x_2))).^2);

MSE_1 = (1/length(x_1))*sum_1
MSE_2 = (1/length(x_2))*sum_2

sgtitle('First method');

%% Second method
%figure(2)
subplot(2,2,3)
sum_3 = 0;

f_C = @(i) (y_1(i+1)-y_1(i-1))/(2*0.5);
f_R = @(i) (-3*y_1(i)+4*y_1(i+1)-y_1(i+2))/(2*0.5); 
f_L = @(i) (y_1(i-2)-4*y_1(i-1)+3*y_1(i))/(2*0.5);

plot(x_1(1,:), f_0(x_1(1,:)), 'b-')
hold on
title('First set')

a = round(length(x_1)/2);
for i=1:a-1
    plot(x_1(1,i), f_R(i), 'g*')
    sum_3 = sum_3 + ((f_0(x_1(1,i)) - f_R(i)).^2);
end

for i=a:length(x_1)
    plot(x_1(1,i), f_L(i), 'r*')
    sum_3 = sum_3 + ((f_0(x_1(1,i)) - f_L(i)).^2);
end

subplot(2,2,4)
sum_4 = 0;

f_C = @(i) (y_2(i+1)-y_2(i-1))/(2*0.2);
f_R = @(i) (-3*y_2(i)+4*y_2(i+1)-y_2(i+2))/(2*0.2); 
f_L = @(i) (y_2(i-2)-4*y_2(i-1)+3*y_2(i))/(2*0.2);

plot(x_2(1,:), f_0(x_2(1,:)), 'b-')
hold on
title('Second set')

a = round(length(x_2)/2);
for i=1:a
    plot(x_2(1,i), f_R(i), 'g*')
    sum_4 = sum_4 + ((f_0(x_2(1,i)) - f_R(i)).^2);
end

for i=a+1:length(x_2)
    plot(x_2(1,i), f_L(i), 'r*')
    sum_4 = sum_4 + ((f_0(x_2(1,i)) - f_L(i)).^2);
end

MSE_3 = (1/length(x_1))*sum_3
MSE_4 = (1/length(x_1))*sum_4

sgtitle({'top -> First method' ,'bottom -> Second method'})